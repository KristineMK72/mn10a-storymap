<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Bernie Penner – MN House District 10A Story Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            overflow-x: hidden;
        }

        /* --- Split-screen layout --- */
        .container {
            display: flex;
            height: 100vh;
            width: 100%;
            flex-direction: column; /* Default to column for mobile */
        }

        /* Left story column */
        .sidebar {
            width: 420px;
            background: #f9fafc;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
            max-height: 100%; /* Ensure it doesn’t overflow */
        }
        .sidebar h2 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.5em;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 10px 0 20px;
        }
        .sidebar a {
            display: block;
            color: #0066cc;
            padding: 8px 10px;
            border-radius: 5px;
            text-decoration: none;
            margin-bottom: 4px;
            transition: background 0.3s;
        }
        .sidebar a:hover, .sidebar a.active {
            background: #ddeeff;
        }
        .section {
            display: none;
            margin-bottom: 30px;
            animation: fadeIn 0.4s;
        }
        .section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .img-placeholder {
            width: 100%;
            height: 240px;
            background: #ddd;
            border-radius: 6px;
            margin: 10px 0;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9em;
            text-align: center;
        }

        /* Map always visible on right */
        #map {
            flex-grow: 1;
            height: 100%;
            width: 100%;
            min-height: 300px; /* Ensure minimum height on mobile */
        }

        /* Search bar in map container */
        .map-container {
            position: relative;
            height: 100%;
        }
        #search-form {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #search-input {
            width: 70%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        #search-btn {
            padding: 8px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #search-btn:hover {
            background: #2980b9;
        }
        #search-result {
            margin-top: 5px;
            font-weight: bold;
            text-align: center;
        }

        /* Mobile and tablet adjustments */
        @media (min-width: 769px) {
            .container {
                flex-direction: row; /* Switch to row for desktop */
            }
            .sidebar {
                width: 420px;
                max-height: 100vh;
                border-right: 1px solid #ddd;
                border-bottom: none;
            }
            #map {
                height: 100vh;
            }
            #search-form {
                left: 420px; /* Offset for sidebar on desktop */
                right: 10px;
                width: auto;
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                max-height: 50vh; /* Adjustable height for mobile */
                border-bottom: 1px solid #ddd;
                border-right: none;
            }
            #map {
                height: 50vh; /* Half screen for mobile */
            }
            .sidebar a {
                font-size: 0.9em;
                padding: 6px 8px;
            }
            .img-placeholder {
                height: 180px;
            }
            #search-input {
                width: 60%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>Bernie Penner for District 10A</h2>
            <ul>
                <li><a href="#intro" onclick="showSection('intro', this)" class="active">Welcome</a></li>
                <li><a href="#demographics" onclick="showSection('demographics', this)">Demographics</a></li>
                <li><a href="#economy" onclick="showSection('economy', this)">Economy</a></li>
                <li><a href="#issues" onclick="showSection('issues', this)">Major Issues</a></li>
                <li><a href="#locations" onclick="showSection('locations', this)">Key Locations</a></li>
                <li><a href="#action" onclick="showSection('action', this)">Get Involved</a></li>
            </ul>

            <div id="intro" class="section active">
                <div class="img-placeholder">Generic photo of Mille Lacs Lake in central Minnesota</div>
                <p><strong>Welcome!</strong> Explore central Minnesota’s lake country and the communities that make up House District 10A. This story map highlights demographics, major issues, and opportunities for growth championed by <strong>Bernie Penner</strong>.</p>
            </div>

            <div id="demographics" class="section">
                <h3>People of District 10A</h3>
                <ul>
                    <li>Population ≈ 43,200</li>
                    <li>Median Age: 41.7</li>
                    <li>Median Income: $62,800</li>
                    <li>93% HS grad, 22% Bachelor’s+</li>
                </ul>
                <div class="img-placeholder">Generic photo of a community gathering in rural Minnesota</div>
            </div>

            <div id="economy" class="section">
                <h3>Economic Drivers</h3>
                <ul>
                    <li>Tourism (28%) – Mille Lacs & Brainerd Lakes</li>
                    <li>Manufacturing (22%)</li>
                    <li>Healthcare & Education (20%)</li>
                    <li>Agriculture (15%)</li>
                </ul>
                <div class="img-placeholder">Generic photo of a factory or manufacturing site in Minnesota</div>
            </div>

            <div id="issues" class="section">
                <h3>Major Issues</h3>
                <ul>
                    <li>Rural Healthcare Access</li>
                    <li>Housing Shortage</li>
                    <li>Education Funding</li>
                    <li>Lake Protection & Forestry</li>
                </ul>
                <div class="img-placeholder">Generic photo of a community discussion or protest in Minnesota</div>
            </div>

            <div id="locations" class="section">
                <h3>Key Locations</h3>
                <ul>
                    <li>Little Falls City Hall</li>
                    <li>Brainerd City Hall</li>
                    <li>Aitkin City Hall</li>
                    <li>Onamia City Hall</li>
                    <li>Milaca County Center</li>
                    <li>Buh Township Hall (Morrison Co.)</li>
                    <li>Garrison Township Hall (Crow Wing Co.)</li>
                    <li>Granite Township Hall (Mille Lacs Co.)</li>
                    <li>Comfort Township Hall (Kanabec Co.)</li>
                    <li>McGregor Township Hall (Aitkin Co.)</li>
                </ul>
                <div class="img-placeholder">Generic photo of a town hall in rural Minnesota</div>
            </div>

            <div id="action" class="section">
                <h3>Get Involved</h3>
                <p>Volunteer, donate, and attend town halls across the district.</p>
                <p><a href="mailto:info@berniepenner.org">info@berniepenner.org</a></p>
                <div class="img-placeholder">Generic photo of a campaign event or volunteer group in Minnesota</div>
            </div>
        </aside>

        <div class="map-container">
            <div id="search-form">
                <input type="text" id="search-input" placeholder="Enter address or city (e.g., Little Falls, MN)" />
                <button id="search-btn" onclick="performSearch()">Search</button>
                <div id="search-result"></div>
            </div>
            <div id="map"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch@3.11.1/dist/geosearch.umd.js"></script>
    <script>
        // Initialize map
        const map = L.map('map').setView([46.25, -93.75], 9); // Centered on District 10A
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Removed district boundary as requested - no GeoJSON layer added

        // Markers for key locations (city halls + corrected township halls)
        const points = [
            ["Little Falls City Hall", [45.98, -94.36]],
            ["Brainerd City Hall", [46.36, -94.20]],
            ["Aitkin City Hall", [46.55, -93.70]],
            ["Onamia City Hall", [46.07, -93.67]],
            ["Milaca County Center", [45.75, -93.65]],
            ["Buh Township Hall (Morrison Co.)", [46.15, -94.50]],
            ["Garrison Township Hall (Crow Wing Co.)", [46.30, -93.82]],
            ["Granite Township Hall (Mille Lacs Co.)", [46.00, -93.50]],
            ["Comfort Township Hall (Kanabec Co.)", [45.85, -93.30]],
            ["McGregor Township Hall (Aitkin Co.)", [46.62, -93.96]]
        ];
        points.forEach(([name, coords]) => {
            L.marker(coords).addTo(map).bindPopup(name);
        });

        // Fit map to district bounds (approximate)
        map.fitBounds([[45.7, -94.6], [46.7, -93.2]]);

        // Geosearch setup for address search
        const provider = new L.GeoSearch.Control.Providers.OpenStreetMap();
        const searchControl = new L.GeoSearch.Control({
            provider: provider,
            position: 'topleft', // Hidden since we use custom form
            autoComplete: true,
            autoCompleteDelay: 250,
        }).addTo(map);

        // Custom search function using Nominatim (OSM)
        async function performSearch() {
            const query = document.getElementById('search-input').value;
            if (!query) return;

            const resultDiv = document.getElementById('search-result');
            resultDiv.innerHTML = 'Searching...';

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ', Minnesota')}&limit=1&addressdetails=1`);
                const data = await response.json();

                if (data && data.length > 0) {
                    const { lat, lon } = data[0];
                    const latLng = [parseFloat(lat), parseFloat(lon)];

                    // Zoom to location
                    map.setView(latLng, 12);

                    // Link to official district finder for accurate check
                    const finderUrl = `https://www.sos.state.mn.us/elections-voting/find-my-polling-place/?county=${encodeURIComponent('All Counties')}&address=${encodeURIComponent(query)}`;
                    resultDiv.innerHTML = `Location found! For accurate District 10A info, <a href="${finderUrl}" target="_blank">check the official MN Secretary of State Polling Place Finder</a>.`;

                    // Add temporary marker
                    L.marker(latLng).addTo(map).bindPopup(`Searched: ${query}<br>Lat/Lon: ${lat}, ${lon}`).openPopup();
                } else {
                    resultDiv.innerHTML = 'Location not found.';
                }
            } catch (error) {
                resultDiv.innerHTML = 'Search error. Try again.';
                console.error(error);
            }
        }

        // Enter key support for search
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });

        // Section switching with map resize
        function showSection(id, link) {
            const sections = document.querySelectorAll(".section");
            sections.forEach(s => s.classList.remove("active"));
            document.getElementById(id).classList.add("active");

            const links = document.querySelectorAll(".sidebar a");
            links.forEach(a => a.classList.remove("active"));
            link.classList.add("active");

            // Force map to resize after section change
            setTimeout(() => {
                map.invalidateSize();
            }, 100); // Slight delay to ensure DOM update
        }

        // Ensure map resizes on window resize
        window.addEventListener('resize', () => map.invalidateSize());

        // Load intro section by default
        window.onload = () => showSection('intro', document.querySelector('.sidebar a'));
    </script>
</body>
</html>
